<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        Dynamix
      {% endblock %}
    </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"  rel="stylesheet" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="http://127.0.0.1:8000/">Dynamix</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="http://127.0.0.1:8000/">Home</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="http://127.0.0.1:8000/simulation/">Simulation</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container">{% block content %} {% endblock %}</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.20.0/matter.min.js" integrity="sha512-6+7rTBmR6pRFe9fa0vCFjFaHZj/XYa7774bEBzRtxgdpIJOS++R3cKd6Prg/eJmxtsJotd8KAg4g57uuVQsZKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" ></script>
    <script defer type="text/javascript" src= "../simulation/pendule.js"></script>


    
    <script>
      var isRunning = false;
      lancementPendule = document.getElementById("pendule")
      lancementPendule.addEventListener("click",function(){

        if (isRunning) return; // If the simulation is already running, do nothing

        isRunning = true;

        var Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Constraint = Matter.Constraint,
          MouseConstraint = Matter.MouseConstraint,
          Mouse = Matter.Mouse,
          Body = Matter.Body;

            // Création de l'engine et du monde
            var engine = Engine.create();
            var world = engine.world;

            // Création du rendu
            var render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: 800,
                    height: 600,
                    wireframes: false
                }
            });

            Render.run(render);

            // Création du moteur physique
            var runner = Runner.create();
            Runner.run(runner, engine);

            // Point d'attache du pendule
            var pivot = Bodies.circle(400, 100, 10, { isStatic: true, render: { fillStyle: "black" } });

            // Variables pour le pendule
            var pendulumRadius = 30;
            var pendulumMass = 1;

            // Création du pendule (initial)
            var pendulum = Bodies.circle(400, 300, pendulumRadius, { 
                mass: pendulumMass, 
                friction: 0, 
                inertia: Infinity, 
                render: { fillStyle: "blue" } 
            });

            // Liaison entre le pivot et le pendule
            var rod = Constraint.create({
                bodyA: pivot,
                bodyB: pendulum,
                length: 200,
                stiffness: 1,
                damping: 0,
                render: { strokeStyle: "black", lineWidth: 3 }
            });

            // Ajout des objets au monde
            Composite.add(world, [pivot, pendulum, rod]);

            // Ajout du contrôle souris
            var mouse = Mouse.create(render.canvas);
            var mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    angularStiffness: 0,
                    render: { visible: false }
                }
            });

            Composite.add(world, mouseConstraint);
            render.mouse = mouse;

            // Fonction pour réinitialiser le pendule
            function resetPendulum() {
                Body.setPosition(pendulum, { x: 400, y: 300 });
                Body.setVelocity(pendulum, { x: 0, y: 0 });
                Body.setAngularVelocity(pendulum, 0);
            }

            // Fonction pour mettre à jour le pendule
            function updatePendulum() {
                // Récupérer les nouvelles valeurs
                var newRadius = parseFloat(document.getElementById("radius").value);
                var newMass = parseFloat(document.getElementById("mass").value);

                // Vérification des entrées utilisateur
                if (isNaN(newRadius) || newRadius <= 0) newRadius = 30;
                if (isNaN(newMass) || newMass <= 0) newMass = 1;

                // Supprimer l'ancien pendule et sa liaison
                Composite.remove(world, [pendulum, rod]);

                // Créer un nouveau pendule avec les nouvelles valeurs
                pendulum = Bodies.circle(400, 300, newRadius, { 
                    mass: newMass, 
                    friction: 0, 
                    inertia: Infinity, 
                    render: { fillStyle: "blue" } 
                });

                // Nouvelle liaison
                rod = Constraint.create({
                    bodyA: pivot,
                    bodyB: pendulum,
                    length: 200,
                    stiffness: 1,
                    damping: 0,
                    render: { strokeStyle: "black", lineWidth: 3 }
                });

                // Ajouter le nouveau pendule au monde
                Composite.add(world, [pendulum, rod]);

                // Réinitialiser la position
                resetPendulum();
            }
      })
  </script>
  </body>
</html>
 
